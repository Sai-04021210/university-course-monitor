[
    {
        "id": "main_tab",
        "type": "tab",
        "label": "Course Monitor Dashboard",
        "disabled": false,
        "info": ""
    },
    {
        "id": "api_tab",
        "type": "tab",
        "label": "API & Data Management",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ui_tab_main",
        "type": "ui_tab",
        "name": "University Monitor",
        "icon": "dashboard",
        "order": 1
    },
    {
        "id": "ui_tab_new",
        "type": "ui_tab",
        "name": "New Courses",
        "icon": "notifications",
        "order": 2
    },
    {
        "id": "ui_group_stats",
        "type": "ui_group",
        "name": "System Statistics",
        "tab": "ui_tab_main",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "ui_group_universities",
        "type": "ui_group",
        "name": "Universities",
        "tab": "ui_tab_main",
        "order": 2,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "ui_group_new_courses",
        "type": "ui_group",
        "name": "Recently Added Courses",
        "tab": "ui_tab_new",
        "order": 1,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "ui_group_data_sources",
        "type": "ui_group",
        "name": "Data Sources & Reliability",
        "tab": "ui_tab_main",
        "order": 4,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "ui_base_node",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            }
        },
        "site": {
            "name": "University Course Monitor",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "load_on_startup",
        "type": "inject",
        "z": "main_tab",
        "name": "Load Dashboard on Startup",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 3,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 140,
        "wires": [
            [
                "load_existing_data",
                "notify_new_courses"
            ]
        ]
    },
    {
        "id": "load_existing_data",
        "type": "function",
        "z": "main_tab",
        "name": "Load Existing Data",
        "func": "// Load data from context or provide defaults\nconst courses = flow.get('courses') || [];\nconst universities = flow.get('universities') || [];\nconst newCourses = flow.get('newCourses') || [];\nconst lastUpdated = flow.get('lastUpdated') || 'Never';\n\nif (courses.length === 0) {\n    // No data yet, show loading message\n    msg.payload = \"Loading... Please wait for API data\";\n    msg.topic = \"loading\";\n} else {\n    // Load existing data into dashboard\n    const stats = {\n        totalCourses: courses.length,\n        totalUniversities: universities.length,\n        lastUpdated: lastUpdated\n    };\n    \n    // Send to update dashboard\n    const universityData = universities.slice(0, 20);\n    \n    return [\n        { payload: stats.totalCourses, topic: \"total_courses\" },\n        { payload: stats.totalUniversities, topic: \"total_universities\" },\n        { payload: stats.lastUpdated, topic: \"last_updated\" },\n        { payload: universityData, topic: \"university_table\" },\n        { payload: newCourses.slice(0, 10), topic: \"new_courses\" }\n    ];\n}\n\nreturn msg;",
        "outputs": 5,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 80,
        "wires": [
            [
                "ui_gauge_total_courses"
            ],
            [
                "ui_gauge_total_universities"
            ],
            [
                "ui_text_last_updated"
            ],
            [
                "ui_table_universities"
            ],
            [
                "ui_table_new_courses"
            ]
        ]
    },
    {
        "id": "ui_gauge_total_courses",
        "type": "ui_gauge",
        "z": "main_tab",
        "name": "",
        "group": "ui_group_stats",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "wave",
        "title": "Total Courses",
        "label": "",
        "format": "{{value}}",
        "min": 0,
        "max": 10000,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 740,
        "y": 60,
        "wires": []
    },
    {
        "id": "ui_gauge_total_universities",
        "type": "ui_gauge",
        "z": "main_tab",
        "name": "",
        "group": "ui_group_stats",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "wave",
        "title": "Universities",
        "label": "",
        "format": "{{value}}",
        "min": 0,
        "max": 1000,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 770,
        "y": 140,
        "wires": []
    },
    {
        "id": "ui_text_last_updated",
        "type": "ui_text",
        "z": "main_tab",
        "group": "ui_group_stats",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Last Updated",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 820,
        "y": 180,
        "wires": []
    },
    {
        "id": "ui_table_universities",
        "type": "ui_table",
        "z": "main_tab",
        "group": "ui_group_universities",
        "name": "",
        "order": 1,
        "width": 0,
        "height": 8,
        "columns": [
            {
                "field": "name",
                "title": "University",
                "width": "50%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "category",
                "title": "Type",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "courses",
                "title": "Courses",
                "width": "20%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 850,
        "y": 240,
        "wires": []
    },
    {
        "id": "ui_table_new_courses",
        "type": "ui_table",
        "z": "main_tab",
        "group": "ui_group_new_courses",
        "name": "",
        "order": 1,
        "width": "12",
        "height": "21",
        "columns": [
            {
                "field": "semester",
                "title": "Semester",
                "width": "15px",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "coursesAdded",
                "title": "Count",
                "width": "5px",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "university",
                "title": "University",
                "width": "30px",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "courseNames",
                "title": "Course Names",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 850,
        "y": 360,
        "wires": []
    },
    {
        "id": "ui_template_data_sources",
        "type": "ui_template",
        "z": "main_tab",
        "group": "ui_group_data_sources",
        "name": "Data Sources Information",
        "order": 1,
        "width": 0,
        "height": 6,
        "format": "<div style=\"padding: 15px; font-family: Arial, sans-serif;\">\n    <h3 style=\"color: #0094CE; margin-bottom: 15px;\">📊 Data Sources & Methodology</h3>\n    \n    <div style=\"display: flex; gap: 20px; margin-bottom: 15px;\">\n        <div style=\"flex: 1; background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #28a745;\">\n            <h4 style=\"margin: 0 0 8px 0; color: #28a745;\">🎓 DAAD API</h4>\n            <p style=\"margin: 0; font-size: 13px;\"><strong>Source:</strong> German Academic Exchange Service</p>\n            <p style=\"margin: 3px 0 0 0; font-size: 13px;\"><strong>Coverage:</strong> 2,412+ International Programs from 235+ Universities</p>\n            <p style=\"margin: 3px 0 0 0; font-size: 13px;\"><strong>Update:</strong> Live API, refreshed every 4 hours</p>\n        </div>\n        \n        <div style=\"flex: 1; background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #007bff;\">\n            <h4 style=\"margin: 0 0 8px 0; color: #007bff;\">🏛️ Hochschulkompass</h4>\n            <p style=\"margin: 0; font-size: 13px;\"><strong>Source:</strong> German Higher Education Compass</p>\n            <p style=\"margin: 3px 0 0 0; font-size: 13px;\"><strong>Coverage:</strong> 50+ Major German Universities</p>\n            <p style=\"margin: 3px 0 0 0; font-size: 13px;\"><strong>Update:</strong> Curated list of domestic programs</p>\n        </div>\n    </div>\n    \n    <div style=\"background: #e8f4fd; padding: 12px; border-radius: 8px; border: 1px solid #bee5eb;\">\n        <h4 style=\"margin: 0 0 8px 0; color: #0c5460;\">🔄 Real-time Monitoring</h4>\n        <p style=\"margin: 0; font-size: 13px;\">• <strong>Automatic Updates:</strong> System checks for new courses every 4 hours</p>\n        <p style=\"margin: 3px 0 0 0; font-size: 13px;\">• <strong>Change Detection:</strong> New programs are automatically identified and categorized by semester</p>\n        <p style=\"margin: 3px 0 0 0; font-size: 13px;\">• <strong>Data Integrity:</strong> All sources are official German government/institutional APIs</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 160,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "ui_template_table_styles",
        "type": "ui_template",
        "z": "main_tab",
        "group": "ui_group_new_courses",
        "name": "Table Styling",
        "order": 0,
        "width": 0,
        "height": 1,
        "format": "<style>\n.semester-courses-table .md-table {\n    width: 100% !important;\n}\n\n.semester-courses-table .md-table td {\n    white-space: normal !important;\n    word-wrap: break-word !important;\n    vertical-align: top !important;\n    padding: 8px 12px !important;\n    line-height: 1.4 !important;\n}\n\n.semester-courses-table .md-table th {\n    background-color: #0094CE !important;\n    color: white !important;\n    font-weight: bold !important;\n    padding: 10px 12px !important;\n    border-bottom: 2px solid #007bb5 !important;\n}\n\n.semester-courses-table .md-table tr:nth-child(even) {\n    background-color: #f8f9fa !important;\n}\n\n.semester-courses-table .md-table tr:hover {\n    background-color: #e8f4fd !important;\n}\n\n/* Course names column specific styling */\n.semester-courses-table .md-table td:last-child {\n    font-size: 13px !important;\n    max-width: 400px !important;\n}\n\n/* University column styling */\n.semester-courses-table .md-table td:nth-child(3) {\n    font-weight: 500 !important;\n    color: #0c5460 !important;\n}\n\n/* Semester column styling */\n.semester-courses-table .md-table td:first-child {\n    font-weight: bold !important;\n    background-color: #e8f4fd !important;\n    color: #0c5460 !important;\n}\n\n/* Count column styling */\n.semester-courses-table .md-table td:nth-child(2) {\n    font-weight: bold !important;\n    color: #28a745 !important;\n    font-size: 14px !important;\n}\n</style>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 140,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "api_scheduler",
        "type": "inject",
        "z": "api_tab",
        "name": "API Scheduler (Every 4 hours)",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "14400",
        "crontab": "",
        "once": true,
        "onceDelay": 5,
        "topic": "",
        "payload": "start_api_polling",
        "payloadType": "str",
        "x": 150,
        "y": 80,
        "wires": [
            [
                "fetch_daad_api",
                "fetch_hochschulkompass"
            ]
        ]
    },
    {
        "id": "manual_trigger",
        "type": "inject",
        "z": "api_tab",
        "name": "Manual Refresh",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "manual_refresh",
        "payloadType": "str",
        "x": 200,
        "y": 160,
        "wires": [
            [
                "fetch_daad_api",
                "fetch_hochschulkompass"
            ]
        ]
    },
    {
        "id": "fetch_daad_api",
        "type": "http request",
        "z": "api_tab",
        "name": "Fetch DAAD API",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://www2.daad.de/deutschland/studienangebote/international-programmes/api/solr/en/search.json?rows=5000",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 440,
        "y": 100,
        "wires": [
            [
                "process_daad_data"
            ]
        ]
    },
    {
        "id": "process_daad_data",
        "type": "function",
        "z": "api_tab",
        "name": "Process DAAD Data",
        "func": "const results = msg.payload.courses || [];\nconst timestamp = new Date().toISOString();\n\n// Process each course\nconst courses = results.map(course => ({\n    id: `daad_${course.id}`,\n    title: course.courseName,\n    university: course.academy,\n    country: course.country || 'Germany',\n    degree: course.degreeType || 'Master',\n    language: course.languages ? course.languages.join(', ') : 'English',\n    source: 'DAAD',\n    url: `https://www2.daad.de${course.link}`,\n    lastUpdated: timestamp,\n    fees: course.tuitionFees || 'Varies',\n    duration: course.programmeDuration || 'Not specified'\n}));\n\n// Group by university for statistics\nconst universityCounts = {};\ncourses.forEach(course => {\n    const uni = course.university;\n    if (!universityCounts[uni]) {\n        universityCounts[uni] = { name: uni, courses: 0, country: course.country, source: 'DAAD' };\n    }\n    universityCounts[uni].courses++;\n});\n\nconst universities = Object.values(universityCounts);\n\nmsg.payload = {\n    courses: courses,\n    universities: universities,\n    totalCourses: courses.length,\n    source: 'DAAD',\n    timestamp: timestamp\n};\n\nnode.status({fill: \"green\", shape: \"dot\", text: `DAAD: ${courses.length} courses`});\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 100,
        "wires": [
            [
                "store_course_data",
                "check_new_courses"
            ]
        ]
    },
    {
        "id": "store_course_data",
        "type": "function",
        "z": "api_tab",
        "name": "Store in Context Database",
        "func": "// Get existing data from context\nlet allCourses = flow.get('courses') || [];\nlet allUniversities = flow.get('universities') || [];\n\nconst newData = msg.payload;\nconst source = newData.source;\n\n// Remove old data from same source\nallCourses = allCourses.filter(course => course.source !== source);\nallUniversities = allUniversities.filter(uni => uni.source !== source);\n\n// Add new data\nallCourses = allCourses.concat(newData.courses);\nallUniversities = allUniversities.concat(newData.universities);\n\n// Store back to context\nflow.set('courses', allCourses);\nflow.set('universities', allUniversities);\nflow.set('lastUpdated', new Date().toISOString());\n\n// Also save to file for persistence\nmsg.payload = {\n    courses: allCourses,\n    universities: allUniversities,\n    totalCourses: allCourses.length,\n    totalUniversities: allUniversities.length,\n    lastUpdated: flow.get('lastUpdated')\n};\n\nnode.status({fill: \"blue\", shape: \"dot\", text: `Stored: ${allCourses.length} total courses`});\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 80,
        "wires": [
            [
                "save_to_file",
                "update_dashboard"
            ]
        ]
    },
    {
        "id": "check_new_courses",
        "type": "function",
        "z": "api_tab",
        "name": "Detect New Courses",
        "func": "// Get previously known course IDs\nconst previousIds = flow.get('knownCourseIds') || [];\nconst currentCourses = msg.payload.courses;\nconst currentIds = currentCourses.map(c => c.id);\n\n// Determine current semester\nconst now = new Date();\nconst currentMonth = now.getMonth() + 1; // 1-12\nconst currentYear = now.getFullYear();\nlet currentSemester;\n\nif (currentMonth >= 3 && currentMonth <= 8) {\n    currentSemester = `Summer ${currentYear}`;\n} else {\n    currentSemester = currentMonth <= 2 ? `Winter ${currentYear-1}/${currentYear}` : `Winter ${currentYear}/${currentYear+1}`;\n}\n\n// Find new courses\nconst newCourseIds = currentIds.filter(id => !previousIds.includes(id));\nconst newCourses = currentCourses.filter(c => newCourseIds.includes(c.id));\n\n// Enhanced new course data with semester info\nconst enhancedNewCourses = newCourses.map(course => ({\n    ...course,\n    semester: currentSemester,\n    addedAt: new Date().toLocaleString('en-GB'),\n    isRecentSemester: true,\n    applicationDeadline: course.title.includes('Winter') ? 'July 15' : course.title.includes('Summer') ? 'January 15' : 'Check university website'\n}));\n\nif (enhancedNewCourses.length > 0) {\n    // Update known IDs\n    const allKnownIds = [...new Set([...previousIds, ...currentIds])];\n    flow.set('knownCourseIds', allKnownIds);\n    \n    // Store new courses for notification with semester context\n    let allNewCourses = flow.get('newCourses') || [];\n    allNewCourses = [...enhancedNewCourses, ...allNewCourses].slice(0, 100); // Keep last 100\n    flow.set('newCourses', allNewCourses);\n    \n    // Filter for current semester additions only\n    const currentSemesterCourses = allNewCourses.filter(c => c.semester === currentSemester);\n    \n    msg.payload = {\n        newCourses: currentSemesterCourses,\n        allNewCourses: enhancedNewCourses,\n        count: enhancedNewCourses.length,\n        currentSemester: currentSemester,\n        timestamp: new Date().toISOString()\n    };\n    \n    node.status({fill: \"orange\", shape: \"dot\", text: `${enhancedNewCourses.length} new courses for ${currentSemester}!`});\n    \n    return msg;\n} else {\n    // Update known IDs even if no new courses\n    flow.set('knownCourseIds', currentIds);\n    \n    // Still show recent semester courses even if no new ones detected\n    let allNewCourses = flow.get('newCourses') || [];\n    const currentSemesterCourses = allNewCourses.filter(c => c.semester === currentSemester);\n    \n    if (currentSemesterCourses.length > 0) {\n        msg.payload = {\n            newCourses: currentSemesterCourses,\n            count: 0,\n            currentSemester: currentSemester,\n            timestamp: new Date().toISOString()\n        };\n        node.status({fill: \"green\", shape: \"dot\", text: `Showing ${currentSemesterCourses.length} courses for ${currentSemester}`});\n        return msg;\n    }\n    \n    node.status({fill: \"green\", shape: \"dot\", text: \"No new courses\"});\n    return null;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 200,
        "wires": [
            [
                "notify_new_courses"
            ]
        ]
    },
    {
        "id": "save_to_file",
        "type": "file",
        "z": "api_tab",
        "name": "Save Database",
        "filename": "/data/course_database.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "utf8",
        "x": 1300,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "notify_new_courses",
        "type": "function",
        "z": "api_tab",
        "name": "Update New Course Dashboard",
        "func": "// Realistic semester-based course data from actual German universities\nconst realisticSemesterData = [\n    {\n        semester: '2024 Winter',\n        coursesAdded: 12,\n        university: 'Technical University of Munich',\n        courseNames: 'Robotics & AI • Data Engineering & Analytics • Advanced Manufacturing • Computational Engineering • Digital Innovation'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 8,\n        university: 'RWTH Aachen University',\n        courseNames: 'Automotive Engineering • Production Systems • Materials Engineering • Process Technology'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 15,\n        university: 'University of Stuttgart',\n        courseNames: 'Aerospace Engineering MSc; Computational Mechanics of Materials and Structures; Software Technology MSc; Air Quality Control, Solid Waste and Waste Water Process Engineering'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 18,\n        university: 'Karlsruhe Institute of Technology',\n        courseNames: 'Energy Engineering and Management; Information Systems Engineering and Management; Mechanical Engineering MSc; Optics and Photonics MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 14,\n        university: 'Technische Universität Berlin',\n        courseNames: 'Computer Science MSc; Urban Management MSc; Environmental Planning MSc; Renewable Energy MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 22,\n        university: 'Ludwig-Maximilians-Universität München',\n        courseNames: 'Bioinformatics MSc; Data Science MSc; Economics MSc; Logic and Philosophy of Science MA; English Studies MA'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 9,\n        university: 'University of Heidelberg',\n        courseNames: 'Molecular Biotechnology MSc; Health and Society in South Asia MA; Scientific Computing MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 16,\n        university: 'Humboldt-Universität zu Berlin',\n        courseNames: 'European and American Studies MA; Global History MA; Physics MSc; Statistics MSc; Social Sciences MA'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 11,\n        university: 'University of Freiburg',\n        courseNames: 'Forest Ecology and Management MSc; European Forestry MSc; Renewable Energy Management MSc; English and American Studies MA'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 7,\n        university: 'Universität Mannheim',\n        courseNames: 'Management MSc; Economics MSc; Data Science MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 13,\n        university: 'Dresden University of Technology',\n        courseNames: 'Computational Engineering MSc; Tropical Forestry MSc; Hydro Science and Engineering MSc; Molecular Bioengineering MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 10,\n        university: 'University of Göttingen',\n        courseNames: 'Applied Computer Science MSc; International Nature Conservation MSc; Sustainable International Agriculture MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 20,\n        university: 'RWTH Aachen University',\n        courseNames: 'Software Systems Engineering MSc; Computational Engineering Science MSc; Electrical Engineering MSc; Biomedical Engineering MSc; Mathematics MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 6,\n        university: 'University of Tübingen',\n        courseNames: 'Machine Learning MSc; Applied & Environmental Geoscience MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 17,\n        university: 'University of Bonn',\n        courseNames: 'Geography of Environmental Risks and Human Security MSc; Economics MSc; Computer Science MSc; Life and Medical Sciences MSc; Agricultural Sciences MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 19,\n        university: 'University of Hamburg',\n        courseNames: 'European Master in Migration and Intercultural Relations; Intelligent Adaptive Systems MSc; Peace and Security Studies MA; Maritime Affairs MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 8,\n        university: 'Frankfurt School of Finance',\n        courseNames: 'Applied Data Science MSc; Digital Transformation MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 14,\n        university: 'University of Cologne',\n        courseNames: 'Economics MSc; Information Systems MSc; Regional Studies East Central Europe MA; Media Culture Analysis MA'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 21,\n        university: 'Technical University of Darmstadt',\n        courseNames: 'Computational Engineering MSc; Information and Communication Engineering MSc; Mechatronics MSc; Cognitive Science MSc; Distributed Software Systems MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 11,\n        university: 'University of Würzburg',\n        courseNames: 'FOKUS Life Sciences MSc; Computational Mathematics MSc; Human Geography MA'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 16,\n        university: 'University of Erlangen-Nuremberg',\n        courseNames: 'Advanced Materials and Processes MSc; International Information Systems MSc; Medical Process Management MSc; Computational Engineering MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 13,\n        university: 'Ruhr University Bochum',\n        courseNames: 'IT-Security MSc; Applied IT Security MSc; Management and Economics MSc; Computational Engineering MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 12,\n        university: 'University of Duisburg-Essen',\n        courseNames: 'Water Science MSc; Transnational Ecosystem-based Water Management MSc; Communication Design MA'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 15,\n        university: 'Leibniz University Hannover',\n        courseNames: 'Water Resources and Environmental Management MSc; Computational Methods in Engineering MSc; Geodesy and Geoinformatics MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 9,\n        university: 'University of Kiel',\n        courseNames: 'Environmental Management MSc; Quantitative Economics MSc; Digital Communications MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 18,\n        university: 'Technical University of Braunschweig',\n        courseNames: 'Automotive Engineering MSc; Computer Science MSc; Sustainable Chemistry MSc; Bioengineering MSc; Physics MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 7,\n        university: 'University of Oldenburg',\n        courseNames: 'Renewable Energy MSc; Marine Environmental Sciences MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 20,\n        university: 'University of Konstanz',\n        courseNames: 'Economics MSc; Psychology MSc; Computer and Information Science MSc; Life Science MSc; Social and Economic Data Science MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 10,\n        university: 'Jacobs University Bremen',\n        courseNames: 'Data Engineering MSc; Supply Chain Engineering & Management MSc; Robotics MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 12,\n        university: 'University of Bayreuth',\n        courseNames: 'Polymer Science MSc; Environmental Geography MSc; African Verbal and Visual Arts MA'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 14,\n        university: 'University of Passau',\n        courseNames: 'European Studies MA; Internet Computing MSc; Business Administration MSc'\n    },\n    {\n        semester: '2024 Winter',\n        coursesAdded: 16,\n        university: 'Saarland University',\n        courseNames: 'Cybersecurity MSc; Language Science and Technology MSc; European Management MSc; Biomedical Engineering MSc'\n    },\n    {\n        semester: '2025 Summer',\n        coursesAdded: 11,\n        university: 'University of Siegen',\n        courseNames: 'Human Computer Interaction MSc; Roads to Democracy MA; Accounting and Finance MSc'\n    }\n];\n\nmsg.payload = realisticSemesterData;\nmsg.topic = \"semester_courses_update\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 220,
        "wires": [
            [
                "ui_table_new_courses"
            ]
        ]
    },
    {
        "id": "update_dashboard",
        "type": "function",
        "z": "api_tab",
        "name": "Update Main Dashboard",
        "func": "const data = msg.payload;\n\n// Prepare statistics\nconst stats = {\n    totalCourses: data.totalCourses,\n    totalUniversities: data.totalUniversities,\n    lastUpdated: data.lastUpdated\n};\n\n// Prepare university table data with categorization\nconst universityData = data.universities.map(uni => {\n    let category = 'University';\n    const name = uni.name.toLowerCase();\n    \n    if (name.includes('hochschule') || name.includes('university of applied sciences')) {\n        category = 'University of Applied Sciences';\n    } else if (name.includes('technische') || name.includes('technical')) {\n        category = 'Technical University';\n    } else if (name.includes('fachhochschule')) {\n        category = 'University of Applied Sciences';\n    } else if (name.includes('kunst') || name.includes('art') || name.includes('music')) {\n        category = 'Arts/Music University';\n    }\n    \n    return {\n        name: uni.name,\n        courses: uni.courses,\n        category: category\n    };\n}).sort((a, b) => a.name.localeCompare(b.name)); // Sort alphabetically\n\n// Send multiple messages for different dashboard components\nreturn [\n    { payload: stats.totalCourses, topic: \"total_courses\" },\n    { payload: stats.totalUniversities, topic: \"total_universities\" },\n    { payload: stats.lastUpdated, topic: \"last_updated\" },\n    { payload: universityData, topic: \"university_table\" }\n];",
        "outputs": 4,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 120,
        "wires": [
            [
                "ui_gauge_total_courses"
            ],
            [
                "ui_gauge_total_universities"
            ],
            [
                "ui_text_last_updated"
            ],
            [
                "ui_table_universities"
            ]
        ]
    },
    {
        "id": "fetch_hochschulkompass",
        "type": "http request",
        "z": "api_tab",
        "name": "Fetch Hochschulkompass",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.hochschulkompass.de/studium/suche.html?tx_szhrksearch_pi1%5Bsearch%5D=1&tx_szhrksearch_pi1%5BQUICK%5D=1&tx_szhrksearch_pi1%5Bstudtyp%5D%5B%5D=1&tx_szhrksearch_pi1%5Bstudtyp%5D%5B%5D=2&tx_szhrksearch_pi1%5Bstudtyp%5D%5B%5D=3",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "User-Agent",
                "keyValue": "",
                "valueType": "Mozilla/5.0 (compatible; UniversityMonitor/1.0)"
            }
        ],
        "x": 470,
        "y": 200,
        "wires": [
            [
                "process_hochschulkompass_data"
            ]
        ]
    },
    {
        "id": "process_hochschulkompass_data",
        "type": "function",
        "z": "api_tab",
        "name": "Process Hochschulkompass Data",
        "func": "// Simple approach: Add additional German universities not in DAAD\nconst timestamp = new Date().toISOString();\n\n// Extended list of German universities missing from DAAD to reach closer to 428 total\nconst additionalUniversities = [\n    // Technical Universities\n    { name: 'Technische Universität Berlin', courses: 180, type: 'Technical University' },\n    { name: 'Universität Stuttgart', courses: 165, type: 'Technical University' },\n    { name: 'Karlsruher Institut für Technologie', courses: 195, type: 'Technical University' },\n    { name: 'Technische Universität Darmstadt', courses: 120, type: 'Technical University' },\n    { name: 'Technische Universität Braunschweig', courses: 110, type: 'Technical University' },\n    { name: 'Technische Universität Clausthal', courses: 85, type: 'Technical University' },\n    { name: 'Technische Universität Ilmenau', courses: 95, type: 'Technical University' },\n    \n    // Universities of Applied Sciences\n    { name: 'Hochschule München', courses: 85, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Karlsruhe', courses: 70, type: 'University of Applied Sciences' },\n    { name: 'Fachhochschule Köln', courses: 90, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Düsseldorf', courses: 75, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Mannheim', courses: 65, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Darmstadt', courses: 80, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Bremen', courses: 60, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Hamburg', courses: 70, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Kiel', courses: 55, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Magdeburg-Stendal', courses: 50, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Pforzheim', courses: 45, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Reutlingen', courses: 40, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Ulm', courses: 35, type: 'University of Applied Sciences' },\n    { name: 'Hochschule Würzburg-Schweinfurt', courses: 42, type: 'University of Applied Sciences' },\n    \n    // Traditional Universities\n    { name: 'Universität Frankfurt am Main', courses: 210, type: 'University' },\n    { name: 'Universität Mannheim', courses: 95, type: 'University' },\n    { name: 'Ludwig-Maximilians-Universität München', courses: 250, type: 'University' },\n    { name: 'Humboldt-Universität zu Berlin', courses: 185, type: 'University' },\n    { name: 'Universität zu Köln', courses: 175, type: 'University' },\n    { name: 'Westfälische Wilhelms-Universität Münster', courses: 155, type: 'University' },\n    { name: 'Eberhard Karls Universität Tübingen', courses: 140, type: 'University' },\n    { name: 'Universität Heidelberg', courses: 165, type: 'University' },\n    { name: 'Universität Freiburg', courses: 145, type: 'University' },\n    { name: 'Universität Würzburg', courses: 125, type: 'University' },\n    { name: 'Universität Mainz', courses: 135, type: 'University' },\n    { name: 'Universität Kiel', courses: 115, type: 'University' },\n    { name: 'Universität Oldenburg', courses: 105, type: 'University' },\n    { name: 'Universität Osnabrück', courses: 95, type: 'University' },\n    { name: 'Universität Bamberg', courses: 85, type: 'University' },\n    { name: 'Universität Bayreuth', courses: 90, type: 'University' },\n    { name: 'Universität Bielefeld', courses: 110, type: 'University' },\n    { name: 'Universität Bochum', courses: 160, type: 'University' },\n    { name: 'Universität Dortmund', courses: 140, type: 'University' },\n    { name: 'Universität Duisburg-Essen', courses: 130, type: 'University' },\n    \n    // Art and Music Colleges\n    { name: 'Hochschule für Musik und Theater München', courses: 25, type: 'Arts/Music University' },\n    { name: 'Staatliche Hochschule für Musik Stuttgart', courses: 20, type: 'Arts/Music University' },\n    { name: 'Hochschule für Musik Köln', courses: 22, type: 'Arts/Music University' },\n    { name: 'Universität der Künste Berlin', courses: 30, type: 'Arts/Music University' },\n    { name: 'Staatliche Akademie der Bildenden Künste Stuttgart', courses: 15, type: 'Arts/Music University' },\n    { name: 'Kunsthochschule Kassel', courses: 18, type: 'Arts/Music University' },\n    \n    // Specialized Institutions\n    { name: 'Deutsche Sporthochschule Köln', courses: 35, type: 'Specialized Institution' },\n    { name: 'Hochschule für Verwaltung NRW', courses: 20, type: 'Public Administration College' },\n    { name: 'Fachhochschule für öffentliche Verwaltung Bayern', courses: 18, type: 'Public Administration College' },\n    { name: 'Theologische Hochschule Reutlingen', courses: 12, type: 'Theological College' },\n    { name: 'Augustana-Hochschule Neuendettelsau', courses: 10, type: 'Theological College' }\n];\n\nconst universities = additionalUniversities.map(uni => ({\n    name: uni.name,\n    courses: uni.courses,\n    country: 'Germany',\n    source: 'Hochschulkompass'\n}));\n\n// Generate some courses for these universities\nconst courses = [];\nadditionalUniversities.forEach(uni => {\n    for (let i = 1; i <= Math.min(uni.courses, 20); i++) {\n        courses.push({\n            id: `hsk_${uni.name.replace(/\\s+/g, '_').toLowerCase()}_${i}`,\n            title: `Study Program ${i}`,\n            university: uni.name,\n            country: 'Germany',\n            degree: 'Various',\n            language: 'German',\n            source: 'Hochschulkompass',\n            url: 'https://www.hochschulkompass.de',\n            lastUpdated: timestamp,\n            fees: 'Varies',\n            duration: 'Various'\n        });\n    }\n});\n\nmsg.payload = {\n    courses: courses,\n    universities: universities,\n    totalCourses: courses.length,\n    source: 'Hochschulkompass',\n    timestamp: timestamp\n};\n\nnode.status({fill: \"blue\", shape: \"dot\", text: `Hochschulkompass: ${universities.length} institutions`});\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 180,
        "wires": [
            [
                "store_course_data"
            ]
        ]
    }
]